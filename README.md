# Discourse 新标签页

> 专注优化 Discourse 论坛多种情况下点击链接的体验,可在新标签页打开主题帖等页面,支持大量可自定义细节,自动识别 Discourse 站点

[English](README_EN.md) | 简体中文

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Greasy Fork](https://img.shields.io/badge/Greasy%20Fork-Install-green)](https://greasyfork.org/zh-CN/scripts/552284-discourse-%E6%96%B0%E6%A0%87%E7%AD%BE%E9%A1%B5)

## 📌 目录

- [为什么需要这个脚本](#为什么需要这个脚本)
- [与其他脚本的区别](#与其他脚本的区别)
- [功能特性](#功能特性)
- [安装](#安装)
- [使用说明](#使用说明)
- [详细规则说明](#详细规则说明)
- [设置界面预览](#设置界面预览)
- [常见问题](#常见问题)
- [未来计划](#未来计划)
- [贡献](#贡献)
- [许可证](#许可证)

## 为什么需要这个脚本

你是否遇到过这些问题?

- 习惯在新标签页打开帖子,不想在同一个页面来回加载切换?
- 不想等帖子加载，想在上一个帖子加载时，继续逛首页和提前开下一个帖子？ 
- 厌倦了每次浏览论坛,都得手动按住 Ctrl 或中键点击链接?
- 发帖求助自动新标签页打开的脚本,却被告知"没有必要"?
- 试过其他同类脚本,但总有不顺手的地方?

那么,试试这个脚本吧。

## 与其他脚本的区别

本脚本和其他脚本有什么区别?

### 1. 自动识别,一键配置

自动识别当前页面是否是 Discourse 论坛并激活,一次配置,一致体验,一个脚本搞定(几乎)全部论坛。也提供白名单和黑名单功能为智能识别兜底。

> **提醒:** 无法被自动识别的论坛大概率是极高度定制的论坛,强行白名单启用可能导致部分规则无法生效或效果错误

### 2. 注重细节体验

许多新标签页脚本要么仅能在首页点击链接时用新标签页打开主题帖,在搜索页面就失效,要么把所有帖子都在新标签页打开,甚至在同一个帖子切换楼层也要新打开一个页面。

本脚本针对这些细节都做了优化,确保无论何时浏览帖子都丝滑而符合直觉。

### 3. 不止主题帖

本脚本对用户主页,附件,弹窗等等也可修改打开方式。而且,如果你不喜欢其中某个设定,想要换成原标签页/新标签页,可以随时在设置界面修改,定制你的冲浪体验。

### 4. 美观的设置界面

设置界面美观,支持夜间模式和语言切换,还可一键将当前域名加入黑白名单。虽然设置界面八百年可能都不会打开一次,但功能还是很齐全的。

> **注:** 脚本默认打开所有配置开关,该状态下是作者自己最习惯的浏览方式。因此,选项在开启情况下,有的是新标签页打开,有的是原生标签打开,这不是设计混乱,是特性QAQ 每个选项打开是什么效果都写清楚了,应该不会引起混淆。

## 功能特性

- ✨ **智能识别** - 自动识别 Discourse 论坛,无需手动配置
- 🛡️ **黑白名单** - 灵活的域名管理,支持强制启用或禁用
- 🎯 **精准控制** - 针对主题帖、用户主页、附件、弹窗、侧边栏等不同场景的细粒度控制
- 🔧 **高度可定制** - 每条规则都可独立启用或禁用
- 🎨 **美观界面** - 设置界面支持浅色/深色/自动夜间模式
- 🌍 **多语言支持** - 支持中文和英文界面切换
- ⚡ **极致性能** - 安装前后浏览速度无感知差异
- 🧩 **后台打开选项** - 可选择将“新标签页”后台打开（无/仅主题帖/全部）

## 安装

### 前置要求

首先需要安装一个用户脚本管理器:

- [Tampermonkey](https://www.tampermonkey.net/) (推荐,支持 Chrome、Firefox、Edge、Safari、Opera)
- [Violentmonkey](https://violentmonkey.github.io/) (支持 Chrome、Firefox、Edge)
- [Greasemonkey](https://www.greasespot.net/) (仅支持 Firefox)

### 安装脚本

安装完脚本管理器后,点击下方链接安装本脚本:

- **Greasy Fork (推荐)**: [点击安装](https://greasyfork.org/zh-CN/scripts/552284-discourse-%E6%96%B0%E6%A0%87%E7%AD%BE%E9%A1%B5)
- **GitHub**: [点击安装](https://github.com/selaky/discourse-new-tab/releases/latest/download/discourse-new-tab.user.js)

## 使用说明

1. 安装脚本后,访问任意 Discourse 论坛即可自动生效
2. 点击浏览器工具栏中的脚本管理器图标,选择"Discourse 新标签页"下的"设置"按钮,即可进入设置界面
3. 在设置界面中可以:
   - 查看当前域名的启用状态
   - 管理白名单和黑名单
   - 配置“后台打开新标签页”的方式
   - 自定义各项跳转规则


## 详细规则说明

所有规则均可在设置界面中独立启用或禁用。以下描述均为规则**开启**时的行为:

### 主题帖规则

- 从任意页面打开主题帖时,用**新标签页**打开
- 在主题帖内部点击其他链接时,用**新标签页**打开
- 如果目标链接与当前页面为同一主题帖(楼层跳转),则**保留原生跳转方式**

### 个人主页规则

- 从任意页面打开用户个人主页时,用**新标签页**打开
- 在用户个人主页内点击其他链接时,用**新标签页**打开
- 如果目标链接与当前页面为同一用户的主页,则**保留原生跳转方式**

### 附件规则

- 打开图片等附件时,**保留原生跳转方式**

### 弹窗规则

#### 用户卡片

- 点击任意用户头像显示的用户卡片中的链接,在**新标签页**打开

#### 用户菜单

- 点击右上角自己的头像显示的用户菜单中的链接,在**新标签页**打开
- 点击分类选项卡切换内容时,**保留原生行为**
- 再次点击已选中的分类图标时,在**新标签页**打开

#### 搜索框

- 在搜索框内点击搜索结果中的链接时,用**新标签页**打开

### 侧边栏规则

- 非主题帖内侧边栏:**保留原生跳转方式**
- 主题帖内侧边栏:用**新标签页**打开

> **规则优先级:** 若一个链接同时满足多条规则,将以顺序靠后的规则为准。

## 设置界面预览

![设置界面截图](screenshots/settings1.0.0.png)

设置界面功能包括:

- 📊 **当前域名状态显示** - 实时显示脚本在当前网站的启用状态及原因
- ✅ **白名单管理** - 手动添加需要强制启用脚本的域名
- 🚫 **黑名单管理** - 手动添加需要强制禁用脚本的域名
- 🔄 **一键添加当前域名** - 快速将当前访问的网站加入白名单或黑名单
- ⚙️ **跳转规则配置** - 所有规则的独立开关,满足个性化需求
- 🐛 **调试模式** - 开启后在控制台输出详细的调试信息,便于问题排查
- 🎨 **主题切换** - 浅色/深色/自动模式
- 🌐 **语言切换** - 中文/English

## 常见问题

### Q: 脚本没有在我常去的论坛生效?

A: 请先检查该论坛是否为 Discourse 论坛。如果是,但脚本未自动识别,可以在设置界面将该域名手动添加到白名单。

### Q: 如何判断一个论坛是否是 Discourse 论坛?

A: Discourse 论坛通常具有以下特征:
- URL 格式类似 `https://域名/t/topic/数字` 或 `https://域名/c/分类名/数字`
- 页面底部通常有 "Powered by Discourse" 标识
- 可以在论坛的"关于"页面查看使用的论坛软件

### Q: 为什么有些极度定制的论坛无法支持?

A: 部分论坛对 Discourse 进行了深度定制,改变了原有的 DOM 结构和行为逻辑,可能导致脚本规则失效或产生意外行为。如遇此类情况,建议将该域名加入黑名单。

### Q: 脚本会影响浏览速度吗?

A: 不会。脚本经过性能优化,在非 Discourse 论坛会自动停止核心功能,仅保留设置菜单入口,对浏览体验几乎无影响。

### Q: 关闭某个规则后,链接会如何打开?

A: 对于默认设定为"保留原生跳转方式"的规则,关闭后会变为"在新标签页打开"。其他规则关闭后则恢复为 Discourse 的原生行为。

## 未来计划

目前脚本已经较为完善,功能基本覆盖了常见使用场景。如果脚本没有明显的 bug 或功能缺陷,后续可能不会频繁更新。

作者是学生,只能不定期进行维护。如果你在使用过程中遇到问题或有新的功能建议,欢迎提交 [Issue](https://github.com/selaky/discourse-new-tab/issues)。

如果你愿意为这个项目做出贡献,也非常欢迎提交 Pull Request!

## 贡献

欢迎各种形式的贡献:

- 🐛 [报告 Bug](https://github.com/selaky/discourse-new-tab/issues/new?labels=bug)
- 💡 [提出新功能建议](https://github.com/selaky/discourse-new-tab/issues/new?labels=enhancement)
- 📝 改进文档
- 🌍 帮助翻译
- 💻 提交代码

### 开发指南

```bash
# 克隆仓库
git clone https://github.com/selaky/discourse-new-tab.git
cd discourse-new-tab

# 安装依赖
npm install

# 开发模式 (监听文件变化自动构建)
npm run dev

# 构建生产版本
npm run build

# 清理构建产物
npm run clean
```

构建后的脚本位于 `dist/discourse-new-tab.user.js`,可直接安装到脚本管理器进行测试。

## 致谢

感谢所有使用和支持本项目的用户!

## 许可证

本项目采用 [MIT](LICENSE) 许可证。

---

<div align="center">

**[⬆ 回到顶部](#discourse-新标签页)**

如果这个项目对你有帮助,请给它一个 ⭐️ !

</div>
