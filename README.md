# Discourse 新标签页（discourse-new-tab）

当前进度：
- 第 1 步（完成）：最小可运行版本（MVP），仅打印"脚本已加载"。
- 第 2 步（完成）：论坛识别模块（多信号加权，阈值 3）。
- 第 3 步（完成）：白/黑名单存储与菜单（开发期调试用）。
  - 优先级：黑名单 > 白名单 > 自动识别。
  - 菜单：始终保留"设置入口（占位）"；另外提供若干"【调试】"菜单，发布前可关闭。
- 第 4 步（完成）：跳转规则实现（主题帖、个人主页、附件、弹窗、侧边栏）。
- 第 5 步（完成）：设置界面（图形化配置管理）。
  - 支持日间/夜间/自动主题切换
  - 支持中文/英文界面切换
  - 白/黑名单可视化管理
  - 跳转规则开关配置

## 开发与构建

1. 安装依赖（开发机需要 Node 16+）

```bash
npm i
```

2. 构建产物（生成 `dist/discourse-new-tab.user.js`）

```bash
npm run build
```

3. 开发模式（监听变更自动重建）

```bash
npm run dev
```

## 安装与验证（Tampermonkey）

1. 在浏览器安装 Tampermonkey 扩展。
2. 将 `dist/discourse-new-tab.user.js` 抛入浏览器或复制内容新建脚本进行安装。
3. 打开任意网页，打开开发者工具控制台，看到：

```
[discourse-new-tab] 脚本已加载（MVP）。
```

即可表示脚本正确注入。

另外你还会在控制台看到：
- 是否识别为 Discourse、得分/阈值、命中信号列表。
- 当前域名启用状态与原因（blacklist/whitelist/auto/disabled）。

在浏览器的 Tampermonkey 菜单中可看到：
- "设置"：打开图形化设置界面，可配置域名列表和跳转规则。
- 若为开发版，还会看到"【调试】…"菜单，用于快捷增删白/黑名单与查看状态。

## 设置界面使用

点击 Tampermonkey 菜单中的"设置"即可打开设置界面:

### 功能特性

1. **主题模式**: 点击右上角太阳/月亮图标切换日间/夜间/自动模式
2. **语言切换**: 点击右上角地球图标切换中文/英文界面
3. **当前状态**: 显示当前域名和脚本启用状态
4. **论坛识别**:
   - 白名单管理：强制启用脚本的域名列表
   - 黑名单管理：强制禁用脚本的域名列表
   - 支持手动添加域名或一键添加当前域名
5. **跳转规则**: 为不同场景配置独立的跳转行为开关

### 界面布局

设置界面采用简约设计,参考 AdGuard 风格:
- 模态对话框居中显示,适中大小不遮挡过多内容
- 响应式布局,移动端自适应
- 清晰的区块划分和层级结构
- 流畅的动画和交互反馈

## 文档

- 接口文档：[docs/api.md](docs/api.md) - 核心API和数据结构
- UI 文档：[docs/ui.md](docs/ui.md) - 设置界面开发指南

## 说明

- 源码（`src/`）与构建产物（`dist/`）分离，仓库不提交产物。
- 发布前可将 `src/main.ts` 中 `DEV_MENUS` 设为 `false`，隐藏调试菜单。
