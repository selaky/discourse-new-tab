# 项目名称
Discourse 智能新标签页打开

# 项目功能说明

## 项目概述
一个简单的自用浏览器javascript脚本，预计在TemperMonkey上使用,用于优化 Discourse 论坛的链接打开行为，对符合规则的链接用新标签页打开,让喜欢用新标签页浏览的人不用再手动按中键或ctrl.

## 技术要求

### 代码管理
- 采用模块化开发方式组织代码
- 最终发布的单文件脚本通过构建工具自动生成，不可直接编辑,可便捷更新
- 降低代码耦合性,提升复用性
- 每个模块只能做自己负责范围内的事

### 性能要求
- 脚本对页面性能影响应降至最低
- 链接打开速度不应有用户可感知的延迟

## 功能需求

### 1. 论坛识别

#### 1.1 自动识别
- 自动检测并识别 Discourse 论坛网站
- 识别成功后启用脚本功能,识别失败则退出脚本.不对论坛外部的Discourse链接负责.

#### 1.2 强制白名单
- 允许用户手动添加网站到白名单
- 用于自动识别失败的情况
- 白名单网站强制启用脚本功能

#### 1.3 黑名单
- 允许用户手动添加网站到黑名单
- 即使网站被识别为 Discourse 论坛，也不运行扩展
- 用于排除用户不想应用此功能的网站

### 2. 链接跳转行为

#### 2.1 核心规则
**同一帖子内的跳转停留在原标签页，其他情况只要涉及帖子则在新标签页打开。**

论坛链接示例:
https://linux.do/
https://linux.do/t/topic/1006706
https://linux.do/t/topic/991874/6
https://linux.do/c/wiki/42
https://linux.do/u/neo/summary
https://meta.appinn.net/t/topic/2319

#### 2.2 新标签页打开的场景
触发规则:原网页和新网页任意一方是帖子(带有帖子编号).

#### 2.3 默认方式打开的场景
本情况优先级高于前者.
以下情况的链接点击维持网站默认行为,不做修改：
- 同一个帖子内的跳转(帖子编号相同,如楼层跳转)
- 两个非帖子页面间的切换
- 弹窗类链接(包括点击用户头像后的悬浮窗)
- 附件类链接（如图片）

#### 2.4 规则控制
- 所有规则可被启用和禁用
- 规则有优先级

#### 2.4 扩展性设计
- 跳转规则判断模块应具备良好的扩展性
- 未来开发者如果需要修改源代码,可以快速增加或减少规则,避免修改大量不同位置
- 自定义规则位置,为未来的用户自定义配置功能预留接口
- 当前只有全局配置,但要为单独域名配置覆盖全局位置功能预留相关内容


### 3. 设置界面

#### 3.1 界面要求
- 提供图形化设置界面
- 界面简洁易用

#### 3.2 设置项
- 白名单管理（添加/修改/删除）
- 黑名单管理（添加/修改/删除）
- 内置规则的启用和禁用

## 未来规划

### 自定义跳转规则
- 当前版本所有网站使用统一的跳转规则
- 未来可能增加全局配置和每个网站独立配置的功能(可共存,独立配置覆盖全局配置)
- 用户可以禁用/启用内置跳转规则(不可删除),也可以增加/删除/启用/禁用自定义规则
- 其他还没想到的配置选项

### 没有其他规划
除非该脚本失效,不会再有其他更新.